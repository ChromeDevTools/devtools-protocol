<link rel="import"
      href="../../bower_components/polymer/polymer.html">
<link rel="import"
      href="../viewer-nav/viewer-nav.html">
<link rel="import"
      href="../viewer-method/viewer-method.html">
<link rel="import"
      href="../html-echo/html-echo.html">

<dom-module id="viewer-app">
  <template>
    <div class="wrapper">
      <viewer-nav
        domains="{{domains}}"
        on-domain-changed="setDomain"></viewer-nav>

      <div class="content" style$="{{getStyle(domain)}}">
        <h2 class="heading" hidden="{{!domain}}"><span>{{domain.name}}</span> Domain</h2>

        <p class="description" hidden="{{!domain}}">
          <html-echo html="{{domain.description}}"></html-echo>
        </p>

        <p class="description" hidden="{{domain}}">Please select a domain on the left.</p>

        <section class="methods" hidden="{{!domain.methods}}">
          <h3><span>{{domain.name}}</span> Methods</h3>

          <div>
            <template is="dom-repeat" items="{{domain.methods}}" as="method">
              <viewer-method
                name="{{method.name}}"
                description="{{method.description}}"
                parameters="{{method.parameters}}"
                returns="{{method.returns}}"
                ></viewer-method>
            </template>
          </div>
        </section>

        <section class="events" hidden="{{!domain.events}}">
          <h3>{{domain.name}} Events</h3>

          <div>
            <template is="dom-repeat" items="{{domain.events}}" as="event">
              <viewer-method
                name="{{event.name}}"
                description="{{event.description}}"
                parameters="{{event.parameters}}"
                ></viewer-method>
            </template>
          </div>
        </section>
      </div>
    </div>
  </template>
  <script>
    (function () {
      function getColor(index, all) {
        var hue = 360 / all * index;
        return "hsl(" + hue + ", 52%, 91%)";
      }

      Polymer({
        is: 'viewer-app',
        ready: function () {
          console.log('App ready');
          this.domain = null;
        },
        setDomain: function (event, details) {
          this.domain = details.domain;
        },
        getStyle: function (domain) {
          return domain && 'background-color: ' + domain.color;
        },
        setProtocolSchema: function (protocolSchema) {
          var domains = protocolSchema['domains'];

          this.domains = domains.sort(function (a, b) {
            return (a.domain).localeCompare(b.domain);
          }).map(function (domain, i) {
            return {
              name: domain['domain'],
              description: domain.description,
              methods: domain.commands,
              events: domain.events,
              types: domain.types,
              color: getColor(i, domains.length)
            };
          });
        }
      });
    })();
  </script>
  <style>
    .wrapper {
      display: flex;
    }

    .content {
      flex-grow: 1;
    }
  </style>
</dom-module>
